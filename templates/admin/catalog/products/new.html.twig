{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Nouveau produit
{% endblock %}

{% block main %}
	<div class="content-panel">
		<form method="post">
			<div class="row">
				<div class="col-md-6">
					<div class="mb-3">
						<label class="form-label">SKU</label>
						<input type="text" name="sku" class="form-control" required>
					</div>

					<div class="mb-3">
						<label class="form-label">Libellé</label>
						<input type="text" name="label" class="form-control" required>
					</div>

					<div class="mb-3">
						<label class="form-label">Catégorie</label>
						<select name="categoryId" class="form-select">
							<option value="">(aucune)</option>
							{% for cat in categories %}
								<option value="{{ cat.id ?? cat._id }}">{{ cat.name ?? cat.label }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="mb-3">
						<label class="form-label">Unité</label>
						<input type="text" name="unit" class="form-control" placeholder="pièce, sac, palette…">
					</div>

					<div class="mb-3 row">
						<div class="col">
							<label class="form-label">Prix HT</label>
							<input type="number" step="0.01" name="price_ht" class="form-control" value="0">
						</div>
						<div class="col">
							<label class="form-label">Prix TTC</label>
							<input type="number" step="0.01" name="price_ttc" class="form-control" value="0">
						</div>
					</div>
				</div>

				<div class="col-md-6">
					<div class="mb-3">
						<label class="form-label">Description (détails)</label>
						<textarea name="description" rows="4" class="form-control"></textarea>
					</div>


					<div class="mb-3">
						<label class="form-label">Caractéristiques techniques</label>
						<div id="attributes-container">
							<div class="row g-2 mb-2 attribute-row">
								<div class="col-5">
									<input type="text" name="attribute_keys[]" class="form-control" placeholder="Nom (ex: longueur_mm)">
								</div>
								<div class="col-6">
									<input type="text" name="attribute_values[]" class="form-control" placeholder="Valeur (ex: 500)">
								</div>
								<div class="col-1 d-flex align-items-center">
									<button type="button" class="btn btn-outline-danger btn-sm btn-remove-attribute">
										<i class="fa fa-times"></i>
									</button>
								</div>
							</div>
						</div>

						<button type="button" id="add-attribute" class="btn btn-sm btn-outline-primary mt-1">
							<i class="fa fa-plus me-1"></i>
							Ajouter une caractéristique
						</button>
					</div>

					<div class="mb-3">
						<label class="form-label">Images (une URL par ligne)</label>
						<textarea name="images" rows="4" class="form-control"></textarea>
					</div>
				</div>
			</div>

			<div class="mt-3">
				<button class="btn btn-primary">
					<i class="fa fa-save me-1"></i>Enregistrer
				</button>
				<a href="{{ path('admin_catalog_products_index') }}" class="btn btn-secondary">Annuler</a>
			</div>
		</form>
	</div>
	{# JS pour gérer les lignes dynamiques #}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
const container = document.getElementById('attributes-container');
const addBtn = document.getElementById('add-attribute');

addBtn.addEventListener('click', function () {
const row = document.createElement('div');
row.className = 'row g-2 mb-2 attribute-row';
row.innerHTML = `
                    <div class="col-5">
                        <input type="text"
                               name="attribute_keys[]"
                               class="form-control"
                               placeholder="Nom (ex: longueur_mm)">
                    </div>
                    <div class="col-6">
                        <input type="text"
                               name="attribute_values[]"
                               class="form-control"
                               placeholder="Valeur (ex: 500)">
                    </div>
                    <div class="col-1 d-flex align-items-center">
                        <button type="button"
                                class="btn btn-outline-danger btn-sm btn-remove-attribute">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                `;
container.appendChild(row);
});

container.addEventListener('click', function (e) {
if (e.target.closest('.btn-remove-attribute')) {
const row = e.target.closest('.attribute-row');
row.remove();
}
});
});
	</script>
{% endblock %}
