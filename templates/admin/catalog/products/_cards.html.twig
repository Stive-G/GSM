<div class="row g-3">
	{% for p in products %}
		{% set pid  = p.id ?? p._id ?? p['_id'] ?? null %}
		{% set imgs = (p.images ?? []) %}
		{% set cid  = p.categoryId ?? null %}
		{% set cname = (cid and categoryMap is defined) ? (categoryMap[cid]|default(null)) : null %}

		<div class="col-12 col-md-6 col-lg-4">
			<div class="card product-card h-100" data-product='{{ { id: pid, sku: p.sku ?? "", label: p.label ?? "", categoryId: cid, categoryName: cname, unit: p.unit ?? null, price_ht: p.price_ht ?? 0, price_ttc: p.price_ttc ?? 0, description: p.description ?? null, attributes: p.attributes ?? {}, images: imgs }|json_encode|e("html_attr") }}'>

				<div class="product-thumb">
					{% if imgs is not empty and imgs[0] is not empty %}
						<img class="product-img" src="{{ imgs[0] }}" alt="{{ p.label ?? '' }}">
					{% else %}
						<div class="no-img">Aucune image</div>
					{% endif %}
				</div>

				<div class="card-body">
					<div class="fw-semibold">{{ p.label ?? '-' }}</div>
					<div class="text-muted small">
						<code>{{ p.sku ?? '-' }}</code>
					</div>

					<div class="mt-2 d-flex gap-2 flex-wrap">
						<span class="badge bg-light text-dark border">
							HT
							{{ (p.price_ht ?? 0)|money }}
						</span>
						<span class="badge bg-light text-dark border">
							TTC
							{{ (p.price_ttc ?? 0)|money }}
						</span>
					</div>
				</div>

				<div class="card-footer d-flex justify-content-between align-items-center">
					<button type="button" class="btn btn-sm btn-outline-secondary btn-details">
						<i class="fa fa-eye"></i>
						DÃ©tails
					</button>

					{% if pid %}
						<a class="btn btn-sm btn-outline-primary" href="{{ path('admin_catalog_products_edit', {id: pid}) }}">
							<i class="fa fa-pen"></i>
						</a>
					{% endif %}
				</div>

			</div>
		</div>
	{% else %}
		<div class="col-12">
			<div class="text-center text-muted py-5">Aucun produit.</div>
		</div>
	{% endfor %}
</div>
